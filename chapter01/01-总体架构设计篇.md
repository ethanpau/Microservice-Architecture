## 互联网架构演进之路 ##

> 一切脱离场景谈架构，都是耍流氓  
> 场景不断驱动架构不断演进  
> 架构师天时地利人和融合的结果 

- 对<del>*业务*</del>场景抽象后得出的支撑骨架
- 架构为<del>*业务*</del>场景而生，被<del>*业务*</del>场景而弃（不断迭代演进的过程）
- 架构没有最好，只有“最适合”
    - 人员技术研发能力/业务复杂程度/数据规模大小/时间成本/运维能力……
- “最适合”架构都是各方面折中(Balance)的结果

## 当体架构设计与实践 ##
- 单体架构 \| Monoliths \| ALL IN ONE

 > 客户端（H5、App、小程序等） \>\> 服务端（接收客户端请求、与数据层交互、逻辑处理、封装处理结果返回客户端） \>\> 数据存储  
 > *服务端构成一个单体应用系统*
 
- Monoliths有点  
    - 开发、测试、部署、扩展(无状态化)都比较容易
- Monoliths适用场景
    - 业务场景简单、功能不复杂、研发人员较少
    - 创业公司初期
    - 性能要求极其苛刻
    
 > 随着业务发展，单体应用无法满足需求——破局
> 数据存储量大/请求量大  
> 垂直拆分（分库）  
> 水平拆分（分表）  
> 架构拆分同理：垂直方向拆分（业务维度）、水平方向拆分（功能维度）

## 面向服务架构设计与实践 ##
- SOA架构  
   - 本质单体架构的垂直拆分（每个服务还是单体），多个服务
   - 通过EBS交互

## 水平分层架构设计与实践 ##
- 分层设计原则
    - 前后端分离架构(返回前端的数据，不带任何展示逻辑)
    - 网关层
       - 请求鉴权（登录鉴权）
       - 数据完整性检查（数据包定长Header+变长body）
       - 协议转换（JSON -> HashMap<String, Object>）
       - 路由转发（根据CMD转发到不同业务逻辑层）
       - 服务治理（服务限流、降级、熔断等）
    - 业务逻辑层(业务逻辑的判断)
    - 数据访问层
       - CRUD：业务增删改查接口（批量）
       - ORM（Mybatis 3）
       - Sharding（分库分表）
       - 屏蔽底层存储差异性（MySQL/MongoDB、Redis）
    - 数据存储层
    
	 > RDBMS(SQLServer、MySQL、Oracle) -> NOSql(MongoDB、redis、HBASE) -> NewSql(RDBMS+NoSql，TiDB)

- 水平分层架构服务和协议
   - 服务类型
      - 网关层（web服务）
      - 业务逻辑层（RPC服务）
      - 数据访问层（RPC服务）
   - 服务协议
      - 网关层（HTTPS+JSON）
      - 业务逻辑层（TCP长连接+二进制协议-protocol buffer）
      - 数据库访问层（TCP长连接+二进制协议）
      
	> 二进制协议（定长Header+变长body）

- 同步架构(四层)
	- 网关层
	- 业务逻辑层
	- 数据访问层
	- 数据存储层

	> 客户端 -> 网关 -> 业务逻辑 -> 数据访问 -> DB -> 数据访问 -> 业务逻辑 -> 网关 -> 客户端

- 异步架构（五层）
   - 网关层
   - 异步消息队列层MQ
   - 业务逻辑层
   - 数据访问层
   - 数据存储层DB/Cache
   
   > 异步目的：提升吞吐量  
   > 异步手段：消息队列  
   > 使用场景一：请求类型（GET-读|POST-写）  
   > 使用场景二：业务类型（金融类不适合|社交类适用）  
	> 当请求响应不依赖业务逻辑处理结果时，可以在网关与业务层之间添加 MQ，构成异步架构

## 微服务架构设计与实践 ##

- 微服务架构
	- 一系列小服务
	- 每个服务运行在独立进程中，服务间采用轻量级通信协议
	- 每个服务围绕具体业务逻辑构建并且能够独立部署
	- 弱中心话管理（根据业务需求可以选择不同的编程语言、不同的存储技术等）

    > MicroServices：业务垂直拆分 + 功能水平拆分  
    > 本质：2个维度拆分；业务架构；组织架构（康威定律）  
    > 目的：快速迭代，持续交付；降本增效  
    > 适用场景：需求层面（需求变化慢，如OA、ERP-无需微服务）；性能层面（提升RT、吞吐量）；数据一致性层面（*<font color='red'>要求数据强一致性的，不适合微服务</font>*，最终一致性）

- 最普适的完整版微服务架构
	- DNS解析  
	- 静态资源  
	- 动态接口数据  

- 微服务架构演进（Service Mesh）
	- 业务团队专注于业务逻辑本身
	- 服务通信交个基础设施团队
	- 物理解耦业务研发团队和基础设施团队
	- 一套基础设施支持多语言开发
	- 基础设置能力从应用程序中下推
	- 真正做到快速迭代，持续交付

## 服务网格架构设计与实践 ##

> 基础设施层  
> 处理服务间通信  
> 实现请求的可靠传递  
> 轻量级网络代理(sidecar)  





